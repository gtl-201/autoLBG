<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>X·ª≠ L√Ω S·ªï ƒê·∫ßu B√†i</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    <link rel="stylesheet" href="sdb.css" />
  </head>
  <body>
    <div class="container">
      <h1>üìñ X·ª≠ L√Ω S·ªï ƒê·∫ßu B√†i</h1>

      <!-- <div class="steps">
        <h3>Quy tr√¨nh ho·∫°t ƒë·ªông:</h3>
        <ol>
          <li>
            <strong>B∆∞·ªõc 1:</strong> Sao ch√©p A1:Q52 t·ª´ file Bu·ªïi Chi·ªÅu ‚Üí
            T1:AJ52 c·ªßa file Bu·ªïi S√°ng (k√®m ƒë·ªãnh d·∫°ng)
          </li>
          <li>
            <strong>B∆∞·ªõc 2:</strong> ƒêi·ªÅn s·ªë ti·∫øt PPCT v√†o c·ªôt D v√† W d·ª±a tr√™n
            n·ªôi dung m√¥n h·ªçc
          </li>
          <li>
            <strong>B∆∞·ªõc 3:</strong> C·∫Øt v√πng T1:AJ52 th√†nh file Bu·ªïi Chi·ªÅu m·ªõi
            v·ªõi ƒë·∫ßy ƒë·ªß ƒë·ªãnh d·∫°ng
          </li>
        </ol>
        <div class="highlight">
          <strong>‚ö†Ô∏è L∆∞u √Ω:</strong> S·ªë ti·∫øt PPCT ch·ªâ ƒë∆∞·ª£c ƒëi·ªÅn t·ª´ h√†ng th·ª© 6
          tr·ªü xu·ªëng (b·ªè qua 5 h√†ng ƒë·∫ßu ti√™n)
        </div>
      </div> -->

      <form id="excelForm">
        <div class="form-group">
          <label for="buoiSang">Ch·ªçn file S·ªï ƒê·∫ßu B√†i Bu·ªïi S√°ng (.xlsx):</label>
          <div class="file-input-wrapper">
            <input
              type="file"
              id="buoiSang"
              class="file-input"
              accept=".xlsx,.xls"
              required
            />
            <label for="buoiSang" class="file-input-label">
              <span class="icon">üìÅ</span>
              Ch·ªçn file Bu·ªïi S√°ng
            </label>
          </div>
          <div class="file-name" id="buoiSangName">Ch∆∞a ch·ªçn file</div>
        </div>

        <div class="form-group">
          <label for="buoiChieu"
            >Ch·ªçn file S·ªï ƒê·∫ßu B√†i Bu·ªïi Chi·ªÅu (.xlsx):</label
          >
          <div class="file-input-wrapper">
            <input
              type="file"
              id="buoiChieu"
              class="file-input"
              accept=".xlsx,.xls"
              required
            />
            <label for="buoiChieu" class="file-input-label">
              <span class="icon">üìÅ</span>
              Ch·ªçn file Bu·ªïi Chi·ªÅu
            </label>
          </div>
          <div class="file-name" id="buoiChieuName">Ch∆∞a ch·ªçn file</div>
        </div>

        <div class="form-group">
          <label for="noiDung">üìö Ch·ªçn file N·ªôi Dung M√¥n H·ªçc (.xlsx):</label>
          <div class="file-input-wrapper">
            <input
              type="file"
              id="noiDung"
              class="file-input"
              accept=".xlsx,.xls"
              required
            />
            <label for="noiDung" class="file-input-label">
              <span class="icon">üìÅ</span>
              Ch·ªçn file N·ªôi Dung
            </label>
          </div>
          <div class="file-name" id="noiDungName">Ch∆∞a ch·ªçn file</div>
        </div>

        <div class="form-group">
          <button type="submit" class="submit-btn" id="submitBtn">
            <span class="icon">‚ö°</span>
            X·ª≠ L√Ω v√† T·∫£i File
          </button>
        </div>
      </form>

      <div class="progress-bar" id="progressBar">
        <div class="progress-fill" id="progressFill"></div>
      </div>

      <div class="status" id="status"></div>
    </div>

    <script>
      // X·ª≠ l√Ω hi·ªÉn th·ªã t√™n file
      document
        .getElementById("buoiSang")
        .addEventListener("change", function (e) {
          const fileName = e.target.files[0]
            ? e.target.files[0].name
            : "Ch∆∞a ch·ªçn file";
          document.getElementById("buoiSangName").textContent = fileName;
        });

      document
        .getElementById("buoiChieu")
        .addEventListener("change", function (e) {
          const fileName = e.target.files[0]
            ? e.target.files[0].name
            : "Ch∆∞a ch·ªçn file";
          document.getElementById("buoiChieuName").textContent = fileName;
        });

      document
        .getElementById("noiDung")
        .addEventListener("change", function (e) {
          const fileName = e.target.files[0]
            ? e.target.files[0].name
            : "Ch∆∞a ch·ªçn file";
          document.getElementById("noiDungName").textContent = fileName;
        });

      // X·ª≠ l√Ω form submit
      document
        .getElementById("excelForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const buoiSangFile = document.getElementById("buoiSang").files[0];
          const buoiChieuFile = document.getElementById("buoiChieu").files[0];
          const noiDungFile = document.getElementById("noiDung").files[0];

          if (!buoiSangFile || !buoiChieuFile || !noiDungFile) {
            showStatus("Vui l√≤ng ch·ªçn ƒë·∫ßy ƒë·ªß c√°c file!", "error");
            return;
          }

          try {
            showStatus("ƒêang x·ª≠ l√Ω file...", "processing");
            showProgress(0);

            // ƒê·ªçc c√°c file Excel
            const buoiSangWorkbook = await readExcelFile(buoiSangFile);
            showProgress(20);

            const buoiChieuWorkbook = await readExcelFile(buoiChieuFile);
            showProgress(40);

            const noiDungWorkbook = await readExcelFile(noiDungFile);
            showProgress(60);

            // X·ª≠ l√Ω d·ªØ li·ªáu theo 3 b∆∞·ªõc
            await processFiles(
              buoiSangWorkbook,
              buoiChieuWorkbook,
              noiDungWorkbook
            );
            showProgress(80);

            // T·∫°o v√† t·∫£i file
            await downloadProcessedFiles(buoiSangWorkbook, buoiChieuWorkbook);
            showProgress(100);

            showStatus(
              "‚úÖ X·ª≠ l√Ω ho√†n th√†nh! C√°c file ƒë√£ ƒë∆∞·ª£c t·∫£i xu·ªëng.",
              "success"
            );
          } catch (error) {
            console.error("L·ªói:", error);
            showStatus("‚ùå C√≥ l·ªói x·∫£y ra: " + error.message, "error");
          }
        });

      function showStatus(message, type) {
        const status = document.getElementById("status");
        status.textContent = message;
        status.className = `status ${type}`;
        status.style.display = "block";

        if (type === "processing") {
          document.getElementById("progressBar").style.display = "block";
        } else {
          setTimeout(() => {
            document.getElementById("progressBar").style.display = "none";
          }, 1000);
        }
      }

      function showProgress(percent) {
        document.getElementById("progressFill").style.width = percent + "%";
      }

      // ƒê·ªçc file Excel
      async function readExcelFile(file) {
        const workbook = new ExcelJS.Workbook();
        const arrayBuffer = await file.arrayBuffer();
        await workbook.xlsx.load(arrayBuffer);
        return workbook;
      }

      // Sao ch√©p v√πng √¥ v·ªõi ƒë·∫ßy ƒë·ªß ƒë·ªãnh d·∫°ng
      function copyRangeWithFormat(
        sourceSheet,
        targetSheet,
        sourceRange,
        targetRange
      ) {
        const sourceStart = ExcelJS.addressToTileRef(sourceRange.split(":")[0]);
        const sourceEnd = ExcelJS.addressToTileRef(sourceRange.split(":")[1]);
        const targetStart = ExcelJS.addressToTileRef(targetRange.split(":")[0]);

        const rowOffset = targetStart.row - sourceStart.row;
        const colOffset = targetStart.col - sourceStart.col;

        for (let row = sourceStart.row; row <= sourceEnd.row; row++) {
          for (let col = sourceStart.col; col <= sourceEnd.col; col++) {
            const sourceCell = sourceSheet.getCell(row, col);
            const targetCell = targetSheet.getCell(
              row + rowOffset,
              col + colOffset
            );

            // Sao ch√©p gi√° tr·ªã
            targetCell.value = sourceCell.value;

            // Sao ch√©p ƒë·ªãnh d·∫°ng
            if (sourceCell.style) {
              targetCell.style = JSON.parse(JSON.stringify(sourceCell.style));
            }

            // Sao ch√©p c√¥ng th·ª©c
            if (sourceCell.formula) {
              targetCell.formula = sourceCell.formula;
            }
          }
        }
      }

      // H√†m chuy·ªÉn ƒë·ªïi ƒë·ªãa ch·ªâ √¥ sang t·ªça ƒë·ªô
      function addressToTileRef(address) {
        const match = address.match(/^([A-Z]+)(\d+)$/);
        if (!match) throw new Error("Invalid cell address");

        const col = match[1];
        const row = parseInt(match[2]);

        let colNum = 0;
        for (let i = 0; i < col.length; i++) {
          colNum = colNum * 26 + (col.charCodeAt(i) - "A".charCodeAt(0) + 1);
        }

        return { row, col: colNum };
      }

      // H√†m chuy·ªÉn ƒë·ªïi t·ªça ƒë·ªô sang ƒë·ªãa ch·ªâ √¥
      function tileRefToAddress(row, col) {
        let colStr = "";
        while (col > 0) {
          col--;
          colStr = String.fromCharCode("A".charCodeAt(0) + (col % 26)) + colStr;
          col = Math.floor(col / 26);
        }
        return colStr + row;
      }

      // ƒê·ªçc d·ªØ li·ªáu n·ªôi dung m√¥n h·ªçc
      async function readNoiDungData(noiDungWorkbook) {
        const noiDungData = {};

        // ƒê·ªçc d·ªØ li·ªáu t·ª´ m·ªói sheet trong file n·ªôi dung
        noiDungWorkbook.worksheets.forEach((sheet) => {
          const sheetName = sheet.name;
          const data = {};

          console.log(`ƒêang ƒë·ªçc sheet n·ªôi dung: ${sheetName}`);

          // Duy·ªát qua t·ª´ng d√≤ng b·∫Øt ƒë·∫ßu t·ª´ d√≤ng 2
          sheet.eachRow((row, rowNumber) => {
            if (rowNumber >= 2) {
              // B·∫Øt ƒë·∫ßu t·ª´ d√≤ng 2
              const tietCell = row.getCell(2); // C·ªôt B
              const tenBaiCell = row.getCell(3); // C·ªôt C

              const tiet = tietCell.value;
              const tenBai = tenBaiCell.value;

              if (
                tiet !== null &&
                tiet !== undefined &&
                tenBai !== null &&
                tenBai !== undefined
              ) {
                // Chuy·ªÉn ƒë·ªïi gi√° tr·ªã th√†nh string ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh nh·∫•t qu√°n
                const tietStr = String(tiet).trim();
                const tenBaiStr = String(tenBai).trim();

                if (tietStr && tenBaiStr) {
                  data[tietStr] = tenBaiStr;
                  console.log(
                    `Sheet ${sheetName} - Ti·∫øt ${tietStr}: ${tenBaiStr}`
                  );
                }
              }
            }
          });

          noiDungData[sheetName] = data;
          console.log(
            `ƒê√£ ƒë·ªçc ${Object.keys(data).length} ti·∫øt t·ª´ sheet ${sheetName}`
          );
        });

        return noiDungData;
      }

      function fillSubjectContent(
        sheet,
        subjectCol,
        periodCol,
        contentCol,
        noiDungData,
        startRow = 6,
        endRow = 52
      ) {
        console.log(
          `ƒêi·ªÅn n·ªôi dung m√¥n h·ªçc t·ª´ h√†ng ${startRow} ƒë·∫øn h√†ng ${endRow}`
        );

        for (let row = startRow; row <= endRow; row++) {
          const subjectCell = sheet.getCell(row, subjectCol);
          const periodCell = sheet.getCell(row, periodCol);
          const contentCell = sheet.getCell(row, contentCol);

          // Ki·ªÉm tra c√≥ m√¥n h·ªçc hay kh√¥ng
          if (subjectCell.value) {
            const subject = String(subjectCell.value).trim();

            // *** X·ª¨ L√ù RI√äNG M√îN "CH√ÄO C·ªú" TR∆Ø·ªöC - KH√îNG C·∫¶N S·ªê TI·∫æT ***
            if (subject.toLowerCase().includes("ch√†o c·ªù")) {
              contentCell.value = "Ph·ªï bi·∫øn n·ªôi dung tu·∫ßn sau";
              console.log(
                `‚úÖ ƒê√£ ƒëi·ªÅn n·ªôi dung ƒë·∫∑c bi·ªát cho m√¥n Ch√†o c·ªù t·∫°i h√†ng ${row}: "Ph·ªï bi·∫øn n·ªôi dung tu·∫ßn sau"`
              );
              continue; // B·ªè qua vi·ªác tra c·ª©u trong noiDungData
            }

            // V·ªõi c√°c m√¥n kh√°c - C·∫¶N C√ì S·ªê TI·∫æT
            if (periodCell.value) {
              const period = String(periodCell.value).trim();

              // T√¨m sheet t∆∞∆°ng ·ª©ng v·ªõi m√¥n h·ªçc
              let tenBai = "Kh√¥ng c√≥ d·ªØ li·ªáu";

              // Duy·ªát qua c√°c sheet ƒë·ªÉ t√¨m t√™n tr√πng v·ªõi m√¥n h·ªçc
              for (const sheetName in noiDungData) {
                if (
                  sheetName.toLowerCase().includes(subject.toLowerCase()) ||
                  subject.toLowerCase().includes(sheetName.toLowerCase())
                ) {
                  // T√¨m th·∫•y sheet ph√π h·ª£p, tra c·ª©u n·ªôi dung theo s·ªë ti·∫øt
                  if (noiDungData[sheetName][period]) {
                    tenBai = noiDungData[sheetName][period];
                    console.log(
                      `T√¨m th·∫•y: ${subject} - Ti·∫øt ${period} - ${tenBai}`
                    );
                    break;
                  }
                }
              }

              // ƒêi·ªÅn n·ªôi dung v√†o √¥
              contentCell.value = tenBai;
            }
          }
        }
      }

      // ƒêi·ªÅn s·ªë ti·∫øt PPCT d·ª±a tr√™n m√¥n h·ªçc (li√™n t·ª•c qua c√°c sheet v√† bu·ªïi) - B·∫ÆT ƒê·∫¶U T·ª™ H√ÄNG 6
      function fillPeriodNumbers(
        sheet,
        subjectCol,
        periodCol,
        globalSubjectPeriods,
        startRow = 6,
        endRow = 52
      ) {
        console.log(`ƒêi·ªÅn s·ªë ti·∫øt PPCT t·ª´ h√†ng ${startRow} ƒë·∫øn h√†ng ${endRow}`);

        for (let row = startRow; row <= endRow; row++) {
          const subjectCell = sheet.getCell(row, subjectCol);
          const periodCell = sheet.getCell(row, periodCol);

          if (subjectCell.value && subjectCell.value.toString().trim()) {
            const subject = subjectCell.value.toString().trim();

            // *** TH√äM ƒêI·ªÄU KI·ªÜN N√ÄY: B·ªè qua m√¥n "Ch√†o c·ªù" ***
            if (subject.toLowerCase().includes("ch√†o c·ªù")) {
              console.log(`B·ªè qua ƒëi·ªÅn s·ªë ti·∫øt PPCT cho m√¥n: ${subject}`);
              continue; // B·ªè qua, kh√¥ng ƒëi·ªÅn s·ªë ti·∫øt
            }

            // TƒÉng s·ªë ti·∫øt cho m√¥n h·ªçc n√†y (li√™n t·ª•c qua c√°c sheet)
            if (!globalSubjectPeriods[subject]) {
              globalSubjectPeriods[subject] = 1;
            } else {
              globalSubjectPeriods[subject]++;
            }

            // ƒêi·ªÅn s·ªë ti·∫øt v√†o √¥
            periodCell.value = globalSubjectPeriods[subject];

            console.log(
              `Sheet: ${sheet.name}, H√†ng: ${row}, M√¥n: ${subject}, Ti·∫øt: ${globalSubjectPeriods[subject]}, C·ªôt: ${periodCol}`
            );
          }
        }
      }

      // X·ª≠ l√Ω ch√≠nh theo 3 b∆∞·ªõc
      async function processFiles(
        buoiSangWorkbook,
        buoiChieuWorkbook,
        noiDungWorkbook
      ) {
        console.log("B·∫Øt ƒë·∫ßu x·ª≠ l√Ω 3 b∆∞·ªõc...");

        // Kh·ªüi t·∫°o b·ªô ƒë·∫øm s·ªë ti·∫øt PPCT to√†n c·ª•c cho t·ª´ng m√¥n h·ªçc
        const globalSubjectPeriods = {};

        // ƒê·ªçc d·ªØ li·ªáu n·ªôi dung m√¥n h·ªçc
        const noiDungData = await readNoiDungData(noiDungWorkbook);

        // X·ª≠ l√Ω t·ª´ng sheet theo th·ª© t·ª±
        buoiSangWorkbook.worksheets.forEach((buoiSangSheet, index) => {
          const buoiChieuSheet = buoiChieuWorkbook.worksheets[index];

          if (buoiChieuSheet) {
            console.log(`ƒêang x·ª≠ l√Ω sheet: ${buoiSangSheet.name}`);

            // B∆∞·ªõc 1: Sao ch√©p A1:Q52 t·ª´ Bu·ªïi Chi·ªÅu ‚Üí T1:AJ52 c·ªßa Bu·ªïi S√°ng
            console.log(
              "B∆∞·ªõc 1: Sao ch√©p d·ªØ li·ªáu t·ª´ Bu·ªïi Chi·ªÅu sang Bu·ªïi S√°ng..."
            );

            // Sao ch√©p t·ª´ng √¥ t·ª´ A1:Q52 sang T1:AJ52
            for (let row = 1; row <= 52; row++) {
              for (let col = 1; col <= 17; col++) {
                // A-Q = 1-17
                const sourceCell = buoiChieuSheet.getCell(row, col);
                const targetCell = buoiSangSheet.getCell(row, col + 19); // T = 20, n√™n offset = 19

                // Sao ch√©p gi√° tr·ªã
                targetCell.value = sourceCell.value;

                // Sao ch√©p ƒë·ªãnh d·∫°ng
                if (sourceCell.style) {
                  targetCell.style = JSON.parse(
                    JSON.stringify(sourceCell.style)
                  );
                }

                // Sao ch√©p c√¥ng th·ª©c
                if (sourceCell.formula) {
                  targetCell.formula = sourceCell.formula;
                }
              }
            }

            // B∆∞·ªõc 2: ƒêi·ªÅn s·ªë ti·∫øt PPCT theo t·ª´ng ng√†y (s√°ng r·ªìi chi·ªÅu) - B·∫ÆT ƒê·∫¶U T·ª™ H√ÄNG 6
            console.log(
              "B∆∞·ªõc 2: ƒêi·ªÅn s·ªë ti·∫øt PPCT theo t·ª´ng ng√†y t·ª´ h√†ng 6 tr·ªü xu·ªëng..."
            );

            // Ki·ªÉm tra √¥ B39 ƒë·ªÉ x√°c ƒë·ªãnh ph·∫°m vi Ch·ªß nh·∫≠t
            const cell39 = buoiSangSheet.getCell(39, 2); // √î B39
            const isSunday5Periods = cell39.value === 5 || cell39.value === "5";

            console.log(
              `Ki·ªÉm tra √¥ B39: ${cell39.value}, Ch·ªß nh·∫≠t ${
                isSunday5Periods ? "5 ti·∫øt (35-39)" : "4 ti·∫øt (35-38)"
              }`
            );

            // ƒê·ªãnh nghƒ©a c√°c kho·∫£ng h√†ng cho t·ª´ng ng√†y trong tu·∫ßn
            const dayRanges = [
              { start: 6, end: 10 }, // Th·ª© 2
              { start: 11, end: 15 }, // Th·ª© 3
              { start: 16, end: 20 }, // Th·ª© 4
              { start: 21, end: 25 }, // Th·ª© 5
              { start: 26, end: 30 }, // Th·ª© 6
              { start: 31, end: 34 }, // Th·ª© 7
              { start: 35, end: isSunday5Periods ? 39 : 38 }, // Ch·ªß nh·∫≠t - ki·ªÉm tra √¥ B39
              {
                start: isSunday5Periods ? 40 : 39,
                end: isSunday5Periods ? 43 : 42,
              }, // .../...
              {
                start: isSunday5Periods ? 44 : 43,
                end: isSunday5Periods ? 47 : 46,
              }, // Th·ª© ...
              {
                start: isSunday5Periods ? 48 : 47,
                end: isSunday5Periods ? 51 : 50,
              }, // .../...
            ];

            // ƒêi·ªÅn s·ªë ti·∫øt theo t·ª´ng ng√†y: s√°ng r·ªìi chi·ªÅu
            dayRanges.forEach((range, dayIndex) => {
              console.log(
                `ƒêang x·ª≠ l√Ω ng√†y th·ª© ${dayIndex + 1} (h√†ng ${range.start}-${
                  range.end
                })`
              );

              // ƒêi·ªÅn bu·ªïi s√°ng tr∆∞·ªõc
              fillPeriodNumbers(
                buoiSangSheet,
                3,
                4,
                globalSubjectPeriods,
                range.start,
                range.end
              );

              // Sau ƒë√≥ ƒëi·ªÅn bu·ªïi chi·ªÅu
              fillPeriodNumbers(
                buoiSangSheet,
                22,
                23,
                globalSubjectPeriods,
                range.start,
                range.end
              );
            });

            // B∆∞·ªõc 2.5: ƒêi·ªÅn n·ªôi dung m√¥n h·ªçc d·ª±a tr√™n s·ªë ti·∫øt
            console.log("B∆∞·ªõc 2.5: ƒêi·ªÅn n·ªôi dung m√¥n h·ªçc...");

            // ƒêi·ªÅn n·ªôi dung cho bu·ªïi s√°ng (c·ªôt C, D, F)
            fillSubjectContent(buoiSangSheet, 3, 4, 6, noiDungData, 6, 52);

            // ƒêi·ªÅn n·ªôi dung cho bu·ªïi chi·ªÅu (c·ªôt V, W, Y - ƒë√£ copy sang c·ªôt 22, 23, 25)
            fillSubjectContent(buoiSangSheet, 22, 23, 25, noiDungData, 6, 52);

            // B∆∞·ªõc 3: C·∫Øt v√πng T1:AJ52 th√†nh file Bu·ªïi Chi·ªÅu m·ªõi
            console.log(
              "B∆∞·ªõc 3: C·∫Øt d·ªØ li·ªáu t·ª´ T1:AJ52 sang file Bu·ªïi Chi·ªÅu m·ªõi..."
            );

            // Sao ch√©p t·ª´ T1:AJ52 (c·ªôt 20-36) v·ªÅ A1:Q52 (c·ªôt 1-17) c·ªßa Bu·ªïi Chi·ªÅu
            for (let row = 1; row <= 52; row++) {
              for (let col = 1; col <= 17; col++) {
                // A-Q = 1-17
                const sourceCell = buoiSangSheet.getCell(row, col + 19); // T = 20, n√™n offset = 19
                const targetCell = buoiChieuSheet.getCell(row, col);

                // Sao ch√©p gi√° tr·ªã
                targetCell.value = sourceCell.value;

                // Sao ch√©p ƒë·ªãnh d·∫°ng
                if (sourceCell.style) {
                  targetCell.style = JSON.parse(
                    JSON.stringify(sourceCell.style)
                  );
                }

                // Sao ch√©p c√¥ng th·ª©c
                if (sourceCell.formula) {
                  targetCell.formula = sourceCell.formula;
                }
              }
            }

            // X√≥a d·ªØ li·ªáu ·ªü v√πng T1:AJ52 c·ªßa file Bu·ªïi S√°ng
            for (let row = 1; row <= 52; row++) {
              for (let col = 20; col <= 36; col++) {
                // T-AJ = 20-36
                const cell = buoiSangSheet.getCell(row, col);
                cell.value = null;
                cell.style = {};
                cell.formula = null;
              }
            }
          }
        });

        console.log("Ho√†n th√†nh x·ª≠ l√Ω 3 b∆∞·ªõc!");
        console.log("T·ªïng s·ªë ti·∫øt c√°c m√¥n h·ªçc:", globalSubjectPeriods);
      }

      // T·∫°o v√† t·∫£i file Excel
      async function downloadProcessedFiles(
        buoiSangWorkbook,
        buoiChieuWorkbook
      ) {
        // T·∫£i file Bu·ªïi S√°ng ƒë√£ ch·ªânh s·ª≠a
        const buoiSangBuffer = await buoiSangWorkbook.xlsx.writeBuffer();
        const buoiSangBlob = new Blob([buoiSangBuffer], {
          type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
        });

        const buoiSangUrl = URL.createObjectURL(buoiSangBlob);
        const buoiSangLink = document.createElement("a");
        buoiSangLink.href = buoiSangUrl;
        buoiSangLink.download = "So Dau Bai Buoi Sang (Da chinh sua).xlsx";
        buoiSangLink.style.display = "none";

        document.body.appendChild(buoiSangLink);
        buoiSangLink.click();
        document.body.removeChild(buoiSangLink);
        URL.revokeObjectURL(buoiSangUrl);

        // T·∫£i file Bu·ªïi Chi·ªÅu ƒë√£ ch·ªânh s·ª≠a
        setTimeout(async () => {
          const buoiChieuBuffer = await buoiChieuWorkbook.xlsx.writeBuffer();
          const buoiChieuBlob = new Blob([buoiChieuBuffer], {
            type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
          });

          const buoiChieuUrl = URL.createObjectURL(buoiChieuBlob);
          const buoiChieuLink = document.createElement("a");
          buoiChieuLink.href = buoiChieuUrl;
          buoiChieuLink.download = "So Dau Bai Buoi Chieu (Da chinh sua).xlsx";
          buoiChieuLink.style.display = "none";

          document.body.appendChild(buoiChieuLink);
          buoiChieuLink.click();
          document.body.removeChild(buoiChieuLink);
          URL.revokeObjectURL(buoiChieuUrl);
        }, 1000);
      }
    </script>
  </body>
</html>
